# Wan2.1 T2V-1.3B 参数说明文档

## 新增命令行参数

### 1. `--offload_model True`
- **功能**: 将模型权重从GPU内存卸载到CPU内存
- **作用**: 减少GPU显存占用，适用于显存不足的情况
- **默认值**: True
- **注意事项**: 会降低推理速度，但能显著节省显存

### 2. `--t5_cpu`
- **功能**: 将T5文本编码器放在CPU上运行
- **作用**: 可以节省大量GPU显存，适合显存受限的环境
- **默认值**: False (不启用)
- **使用方法**: 添加此参数即可启用，无需指定值

### 3. `--sample_shift 8`
- **功能**: 控制视频生成过程中的时间偏移强度
- **作用**: 值越大，相邻帧之间的变化越剧烈，视频动态效果越明显
- **默认值**: 8.0
- **推荐范围**: 4.0 - 12.0
- **效果说明**: 
  - 低值(4-6): 生成更平滑、静态的视频
  - 高值(8-12): 生成更动态、变化剧烈的视频

### 4. `--sample_guide_scale 6`
- **功能**: 控制生成视频对文本提示词的遵循程度
- **作用**: 值越大，生成内容越严格遵循提示词
- **默认值**: 6.0
- **推荐范围**: 4.0 - 10.0
- **效果说明**:
  - 低值(4-6): 生成内容更自由，可能偏离提示词但质量较高
  - 高值(7-10): 生成内容更严格遵循提示词，但可能降低视频质量

## 使用方法

### 方法1: 使用启动脚本（推荐）
```bash
./run_t2v.sh
```

### 方法2: 直接运行Python脚本
```bash
cd gradio
python t2v_1.3B_singleGPU.py \
    --ckpt_dir ../Wan2.1-T2V-1.3B \
    --offload_model \
    --t5_cpu \
    --sample_shift 8 \
    --sample_guide_scale 6
```

### 方法3: 通过Gradio界面控制
启动程序后，在Gradio界面中：
1. 展开"命令行参数控制"区域
2. 调整各个参数的值
3. 点击"Generate Video"按钮生成视频

**注意**: 界面参数的优先级低于命令行参数

### 方法3: 自定义参数
```bash
cd gradio
python t2v_1.3B_singleGPU.py \
    --ckpt_dir ../Wan2.1-T2V-1.3B \
    --offload_model True \
    --t5_cpu \
    --sample_shift 10 \
    --sample_guide_scale 8
```

## 参数优先级

参数优先级从高到低：
1. **命令行参数** (最高优先级)
2. **界面基础参数** (最低优先级)

具体覆盖关系：
- `--sample_shift` 会覆盖界面中的"偏移比例"滑块
- `--sample_guide_scale` 会覆盖界面中的"引导比例"滑块
- `--offload_model` 会覆盖界面中的"模型卸载"复选框
- `--t5_cpu` 会覆盖界面中的"T5 CPU运行"复选框

**重要说明**: 为了避免参数重复和混淆，界面中只保留基础参数。高级参数通过命令行设置，这样可以确保参数的一致性和清晰性。

## 界面功能说明

### 界面布局

所有参数现在都整合在一个"生成参数设置"区域中，分为两个部分：

#### 1. 基础参数
- **视频分辨率**: 选择生成视频的分辨率
- **扩散步数**: 控制采样质量，步数越多质量越高
- **引导比例**: 控制文本遵循程度
- **偏移比例**: 控制视频动态效果
- **随机种子**: 控制随机性，-1表示随机生成
- **负面提示词**: 描述不希望出现的内容

#### 2. 高级优化参数
- **模型卸载**: 控制是否将模型权重卸载到CPU

**注意**: 
- 时间偏移和引导比例参数使用基础参数区域的设置。如需覆盖，请使用命令行参数。
- T5 CPU运行默认开启以节省显存，可通过 `--t5_cpu false` 关闭。

### 界面特点
- 所有参数都在一个折叠区域中，布局清晰
- 每个控件都有详细的中文说明和提示信息
- 避免了参数重复，逻辑更加清晰
- 界面默认展开，方便用户操作

## 显存优化建议

### 低显存环境 (< 8GB)
```bash
python t2v_1.3B_singleGPU.py \
    --ckpt_dir ../Wan2.1-T2V-1.3B \
    --offload_model True \
    --t5_cpu
```

### 中等显存环境 (8-12GB)
```bash
python t2v_1.3B_singleGPU.py \
    --ckpt_dir ../Wan2.1-T2V-1.3B \
    --offload_model True
```

### 高显存环境 (> 12GB)
```bash
python t2v_1.3B_singleGPU.py \
    --ckpt_dir ../Wan2.1-T2V-1.3B \
    --offload_model False
```

## 注意事项

1. **T5 CPU运行**: 启用后会显著降低文本处理速度，但能节省大量显存
2. **模型卸载**: 启用后会降低整体推理速度，但能处理更大的视频分辨率
3. **参数调优**: `sample_shift`和`sample_guide_scale`需要根据具体需求调整
4. **显存监控**: 建议使用`nvidia-smi`监控GPU显存使用情况
